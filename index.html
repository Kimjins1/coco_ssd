<html>

<head>
    <title>Coco SSD</title>
    <script src="./tf.min.js"> </script>
    <script src="./coco-ssd.js"> </script>
</head>

<body>
    <div id="info">...</div>
    <video id="videoInput" width="320" height="240" style="position: absolute; left:10; top:30"></video>
    <canvas id="videoOutput" width="320" height="240" style="position: absolute; left:10; top:30"></canvas>
    <script>
        const info = document.getElementById("info");
        const constraints = { audio: false, video: true };
        const video = document.getElementById("videoInput");
        function successCallback(stream) {
            video.srcObject = stream;
            video.play();
        }
        function errorCallback(error) {
            console.log(error);
        }
        navigator.getUserMedia(constraints, successCallback, errorCallback);

        let net;
        async function makeNet() {
            info.innerHTML = "Now loading... Please wait.";
            net = await cocoSsd.load();
            info.innerHTML = "Ready to use!";
            setInterval(detect, 0);
        }
        makeNet();

        let predict;
        const canvas = document.getElementById("videoOutput");
        const ctx = canvas.getContext("2d");
        ctx.strokeStyle = "rgb(0, 255, 0)";
        ctx.lineWidth = 3;
        ctx.font = "15px Arial";

        async function detect() {
            predict = await net.detect(video);
            info.innerHTML = "Object No. : " + predict.length;
            if (predict.length > 0) {
                ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
                ctx.strokeRect(predict[0].bbox[0], predict[0].bbox[1], predict[0].bbox[2], predict[0].bbox[3]);
            }
        }
    </script>
</body>

</html>
